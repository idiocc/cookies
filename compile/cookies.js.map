{
"version":3,
"file":"compile/cookies.js",
"lineCount":179,
"mappings":"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",
"sources":["node_modules/crypto/index.js","src/keygrip-lib/sign.js","src/keygrip-lib/ctc.js","src/Keygrip.js","node_modules/http/index.js","src/Cookie.js","src/index.js","src/depack.js"],
"sourcesContent":["export default _crypto\nexport const {\n  Certificate,\n  Cipher,\n  Credentials,\n  DEFAULT_ENCODING,\n  Decipher,\n  DiffieHellman,\n  ECDH,\n  Hash,\n  Hmac,\n  Verify,\n  createCipher,\n  createCipheriv,\n  createCredentials,\n  createDecipher,\n  createDecipheriv,\n  createDiffieHellman,\n  createECDH,\n  createHash,\n  createHmac,\n  createSign,\n  createVerify,\n  getCiphers,\n  getCurves,\n  getDiffieHellman,\n  getHashes,\n  pbkdf2,\n  pbkdf2Sync,\n  privateDecrypt,\n  privateEncrypt,\n  pseudoRandomBytes,\n  publicDecrypt,\n  publicEncrypt,\n  randomBytes,\n  randomFill,\n  randomFillSync,\n  timingSafeEqual,\n} = _crypto","import { createHmac } from 'crypto'\n\nexport function sign(data, algorithm, key, encoding) {\n  return createHmac(algorithm, key)\n    .update(data).digest(encoding)\n    .replace(/\\/|\\+|=/g, (x) => {\n      return ({ '/': '_', '+': '-', '=': '' })[x]\n    })\n}","// http://codahale.com/a-lesson-in-timing-attacks/\nexport const constantTimeCompare = function(val1, val2){\n  if (val1 == null && val2 != null){\n    return false\n  } else if (val2 == null && val1 != null){\n    return false\n  } else if (val1 == null && val2 == null){\n    return true\n  }\n\n  if (val1.length != val2.length){\n    return false\n  }\n\n  var result = 0\n\n  for (var i = 0; i < val1.length; i++) {\n    result |= val1.charCodeAt(i) ^ val2.charCodeAt(i) //Don't short circuit\n  }\n\n  return result === 0\n}\n","import { sign } from './keygrip-lib/sign'\nimport { constantTimeCompare } from './keygrip-lib/ctc'\n\n/* start example */\n/**\n * @implements {_goa.Keygrip}\n */\nexport default class Keygrip {\n  constructor(keys, algorithm = 'sha1', encoding = 'base64') {\n    if (!keys || !(0 in keys)) {\n      throw new Error('Keys must be provided.')\n    }\n    this.algorithm = algorithm\n    this.encoding = encoding\n    this.keys = keys\n  }\n  sign(data) {\n    return sign(data, this.algorithm, this.keys[0], this.encoding)\n  }\n  verify(data, digest) {\n    return this.index(data, digest) > -1\n  }\n  index(data, digest) {\n    for (let i = 0, l = this.keys.length; i < l; i++) {\n      const sig = sign(data, this.algorithm, this.keys[i], this.encoding)\n      if (constantTimeCompare(digest, sig)) return i\n    }\n\n    return -1\n  }\n}\n/* end example */\n\n/*!\n * keygrip\n * Copyright(c) 2011-2014 Jed Schmidt\n * MIT Licensed\n */\n","export default http\nexport const {\n  Agent,\n  ClientRequest,\n  IncomingMessage,\n  METHODS,\n  OutgoingMessage,\n  STATUS_CODES,\n  Server,\n  ServerResponse,\n  createServer,\n  get,\n  globalAgent,\n  maxHeaderSize,\n  request,\n} = http","/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\nconst fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/\n\n/**\n * RegExp to match Same-Site cookie attribute value.\n */\nconst sameSiteRegExp = /^(?:lax|strict)$/i\n\n/**\n * @implements {_goa.CookieAttributes}\n */\nexport default class Cookie {\n  /**\n   * @param {string} name\n   * @param {?string} [value]\n   * @param {!_goa.CookieAttributes} [attrs]\n   */\n  constructor(name, value, attrs) {\n    this.path = '/'\n    this.expires = undefined\n    this.domain = undefined\n    this.maxAge = undefined\n    this.httpOnly = true\n    this.sameSite = false\n    this.secure = false\n    this.overwrite = false\n\n    if (!fieldContentRegExp.test(name)) {\n      throw new TypeError('argument name is invalid')\n    }\n\n    if (value && !fieldContentRegExp.test(value)) {\n      throw new TypeError('argument value is invalid')\n    }\n\n    value || (this.expires = new Date(0))\n\n    this.name = name\n    this.value = value || ''\n\n    for (let n in attrs) {\n      /** @suppress {checkTypes} */\n      this[n] = attrs[n]\n    }\n\n    if (this.path && !fieldContentRegExp.test(this.path)) {\n      throw new TypeError('option path is invalid')\n    }\n\n    if (this.domain && !fieldContentRegExp.test(this.domain)) {\n      throw new TypeError('option domain is invalid')\n    }\n\n    if (this.sameSite && this.sameSite !== true && !sameSiteRegExp.test(this.sameSite)) {\n      throw new TypeError('option sameSite is invalid')\n    }\n  }\n  toHeader() {\n    var header = this.toString()\n\n    if (this.maxAge) this.expires = new Date(Date.now() + this.maxAge)\n\n    if (this.path) header += '; path=' + this.path\n    if (this.expires) header += '; expires=' + this.expires.toUTCString()\n    if (this.domain) header += '; domain=' + this.domain\n    if (this.sameSite) {\n      header += '; samesite='\n      if (this.sameSite === true) header += 'strict'\n      else {\n        /**\n         * @suppress {checkTypes}\n         * @type {string}\n         */\n        const sameSite = this.sameSite.toLowerCase()\n        header += sameSite\n      }\n    }\n    if (this.secure) header += '; secure'\n    if (this.httpOnly) header += '; httponly'\n\n    return header\n  }\n  toString() {\n    return this.name + '=' + this.value\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').CookieAttributes} _goa.CookieAttributes\n */","/*!\n * cookies\n * Copyright(c) 2014 Jed Schmidt, http://jed.is/\n * Copyright(c) 2015-2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\nimport Keygrip from './Keygrip'\nimport { OutgoingMessage } from 'http'\nimport Cookie from './Cookie'\n\nconst cache = {}\n\n/**\n * @implements {_goa.Cookies}\n */\nexport default class Cookies {\n  /**\n   * Creates a new cookies object to handle cookies.\n   * @param {!http.IncomingMessage} request\n   * @param {!http.ServerResponse} response\n   * @param {!_goa.CookiesOptions} [options] Options for the constructor.\n   */\n  constructor(request, response, options) {\n    this.secure = undefined\n    this.request = request\n    this.response = response\n    if (options) {\n      /** @type {!_goa.Keygrip|undefined} */\n      this.keys = Array.isArray(options.keys) ? new Keygrip(options.keys) : options.keys\n      this.secure = options.secure\n    }\n  }\n  /**\n   * @param {string} name\n   * @param {{ signed: boolean }} [opts]\n   */\n  get(name, opts) {\n    const sigName = `${name}.sig`\n    let header, match, index\n    const signed = opts && opts.signed !== undefined ? opts.signed : !!this.keys\n\n    /** @suppress {checkTypes} */\n    header = this.request.headers['cookie']\n    if (!header) return\n\n    match = header.match(getPattern(name))\n    if (!match) return\n\n    const value = match[1]\n    if (!opts || !signed) return value\n\n    const remote = this.get(sigName)\n    if (!remote) return\n\n    const data = name + '=' + value\n    if (!this.keys) throw new Error('.keys required for signed cookies')\n    index = this.keys.index(data, remote)\n\n    if (index < 0) {\n      this.set(sigName, null, { path: '/', signed: false })\n    } else {\n      index && this.set(sigName, this.keys.sign(data), { signed: false })\n      return value\n    }\n  }\n  /**\n   * @param {string} name The name of the cookie to set.\n   * @param {?string} [value] The value of the cookie to set.\n   * @param {!_goa.CookieSetOptions} [opts] How the cookie will be set.\n   * @param {boolean} [opts.signed=false] Indicating whether the cookie is to be signed. If this is true, another cookie of the same name with the .sig suffix appended will also be sent, with a 27-byte url-safe base64 SHA1 value representing the hash of cookie-name=cookie-value against the first Keygrip key. This signature key is used to detect tampering the next time a cookie is received. Default `false`.\n   */\n  set(name, value, opts = {}) {\n    const { response: res, request: req } = this\n    let headers = /** @type {!Array<string>} */ (res.getHeader('Set-Cookie')) || []\n    if (typeof headers == 'string') headers = [headers]\n\n    /** @suppress {checkTypes} */\n    const proto = req['protocol']\n    /** @suppress {checkTypes} */\n    const encrypted = req.connection['encrypted']\n    let secure = this.secure !== undefined ? !!this.secure : proto == 'https' || encrypted\n\n    const { signed = !!this.keys, ...rest } = opts\n    const cookie = new Cookie(name, value, rest)\n\n    if (!secure && opts.secure) {\n      throw new Error('Cannot send secure cookie over unencrypted connection')\n    }\n\n    cookie.secure = secure\n    if (!('secure' in opts)) cookie.secure = secure\n\n    pushCookie(headers, cookie)\n\n    if (opts && signed) {\n      if (!this.keys) throw new Error('.keys required for signed cookies')\n      cookie.value = this.keys.sign(cookie.toString())\n      cookie.name += '.sig'\n      pushCookie(headers, cookie)\n    }\n\n    /** @suppress {checkTypes} */\n    const set = res['set']\n    const setHeader = set ? OutgoingMessage.prototype.setHeader : res.setHeader\n    setHeader.call(res, 'Set-Cookie', headers)\n    return this\n  }\n}\n\nfunction getPattern(name) {\n  if (cache[name]) return cache[name]\n\n  return cache[name] = new RegExp(\n    '(?:^|;) *' +\n    name.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&') +\n    '=([^;]*)'\n  )\n}\n\n/**\n * @param {!Array<string>} headers\n * @param {!Cookie} cookie\n */\nfunction pushCookie(headers, cookie) {\n  if (cookie.overwrite) {\n    for (var i = headers.length - 1; i >= 0; i--) {\n      if (headers[i].indexOf(cookie.name + '=') === 0) {\n        headers.splice(i, 1)\n      }\n    }\n  }\n\n  headers.push(cookie.toHeader())\n}\n\nexport const connect = (keys) => {\n  return (req, res, next) => {\n    req['cookies'] = res['cookies'] = new Cookies(req, res, { keys })\n    next()\n  }\n}\nexport const express = connect\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').IncomingMessage} http.IncomingMessage\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').ServerResponse} http.ServerResponse\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CookieAttributes} _goa.CookieAttributes\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').Keygrip} _goa.Keygrip\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CookiesOptions} _goa.CookiesOptions\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').CookieSetOptions} _goa.CookieSetOptions\n */","import '../types/externs'\n\nimport Cookies, { connect, express } from './'\nimport Keygrip from './Keygrip'\n\nmodule.exports = {\n  '_Cookies': Cookies,\n  '_Keygrip': Keygrip,\n  'express': express,\n  'connect': connect,\n}"],
"names":["createHmac","_crypto","sign","data","algorithm","key","encoding","update","digest","replace","x","constantTimeCompare","val1","val2","length","result","i","charCodeAt","Keygrip","keys","Error","index","l","sig","OutgoingMessage","http","fieldContentRegExp","sameSiteRegExp","toHeader","header","toString","maxAge","expires","Date","now","path","toUTCString","domain","sameSite","toLowerCase","secure","httpOnly","Cookie","name","value","attrs","undefined","overwrite","test","TypeError","n","cache","Cookies","request","response","options","Array","isArray","opts","sigName","signed","headers","match","RegExp","remote","get","set","res","req","getHeader","proto","encrypted","connection","rest","cookie","pushCookie","call","setHeader","prototype","indexOf","splice","push","connect","next","module","exports","express"]
}
